<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Diagnostic Terminal - Bright</title>
    <!-- Config MUST load before Tailwind CDN for some environments -->
    <script>
        tailwind = {
            config: {
                theme: {
                    extend: {
                        colors: {
                            "primary": "#E91E63", // PinkBlue Brand Pink
                            "primary-dark": "#C2185B",
                            "primary-light": "#FCE4EC",
                            "accent": "#007AFF", // PinkBlue Brand Blue
                            "accent-teal": "#30D158",
                            "background": "#FDF2F8", // Very light pink tint
                            "background-light": "#FFF0F5",
                            "surface": "#FFFFFF",
                            "text-main": "#1E293B", // Slate 800
                            "text-sec": "#64748B",
                            "text-muted": "#8E8E93",
                            "border-color": "#E2E8F0",
                            "border-light": "#E5E5EA",
                            "success": "#10B981",
                            "danger": "#EF4444",
                        },
                        fontFamily: {
                            "display": ["Space Grotesk", "sans-serif"],
                            "body": ["Noto Sans", "sans-serif"],
                        },
                        boxShadow: {
                            'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                            'card': '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1)',
                            'floating': '0 10px 40px -10px rgba(0, 0, 0, 0.15)',
                            "glow-sm": "0 0 8px rgba(0, 122, 255, 0.3)",
                            "soft-panel": "0 4px 20px rgba(0,0,0,0.04)",
                            "inner-bright": "inset 0 1px 3px rgba(0,0,0,0.02)"
                        },
                        animation: {
                            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        }
                    },
                },
            }
        }
    </script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Noto+Sans:wght@400;500;700&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <style>
        /* Fallback Styles (PinkBlue Brand) */
        .bg-primary {
            background-color: #E91E63 !important;
        }

        .text-primary {
            color: #E91E63 !important;
        }

        .border-primary {
            border-color: #E91E63 !important;
        }

        .hover\:bg-primary-dark:hover {
            background-color: #C2185B !important;
        }

        /* Gradient Fallback for big button */
        .from-white {
            --tw-gradient-from: #fff;
        }

        .to-slate-50 {
            --tw-gradient-to: #f8fafc;
        }

        .hide-scroll::-webkit-scrollbar {
            display: none;
        }

        .hide-scroll {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .bg-grid-pattern {
            background-size: 40px 40px;
            background-image: linear-gradient(to right, rgba(226, 232, 240, 0.5) 1px, transparent 1px), linear-gradient(to bottom, rgba(226, 232, 240, 0.5) 1px, transparent 1px);
        }

        .pulse-ring {
            animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }

        @keyframes pulse-ring {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(0, 122, 255, 0.4);
            }

            70% {
                transform: scale(1);
                box-shadow: 0 0 0 20px rgba(0, 122, 255, 0);
            }

            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(0, 122, 255, 0);
            }
        }
    </style>
</head>

<body class="bg-white text-text-main font-body antialiased overflow-hidden h-screen flex flex-col relative">

    <!-- ===== AUTH OVERLAY (Restored) ===== -->
    <section id="auth-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-white/95 backdrop-blur-xl">
        <div class="w-full max-w-sm p-8 text-center">
            <div class="mb-6 inline-flex p-4 rounded-full bg-blue-50 text-primary mb-6 ring-4 ring-blue-50/50">
                <span class="material-symbols-outlined text-4xl">medical_services</span>
            </div>
            <h1 class="text-2xl font-bold font-display text-text-main mb-2">Diagnostic Terminal</h1>
            <p class="text-text-sec text-sm mb-8">Secure Access Required</p>

            <form id="login-form" class="space-y-4">
                <div class="relative">
                    <span class="material-symbols-outlined absolute left-3 top-3 text-text-muted">mail</span>
                    <input type="email" id="user-email" required placeholder="Enter your credentials"
                        class="w-full pl-10 pr-4 py-3 bg-white border border-border-color rounded-xl text-text-main placeholder-text-muted focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all shadow-sm">
                </div>
                <button type="submit"
                    class="w-full py-3.5 rounded-xl bg-primary text-white font-bold shadow-lg hover:shadow-xl hover:bg-primary-dark transition-all transform active:scale-95">
                    AUTHENTICATE
                </button>
            </form>
            <p class="mt-6 text-xs text-text-muted">Authorized Personnel Only ‚Ä¢ v2.1</p>
        </div>
    </section>

    <!-- ===== DASHBOARD SCREEN (Bright) ===== -->
    <section id="dashboard-screen" class="screen hidden flex flex-col h-full overflow-hidden bg-background-light">
        <header
            class="relative z-20 flex items-center justify-between px-6 py-4 bg-white/80 backdrop-blur-md border-b border-border-light shadow-sm">
            <div class="flex items-center gap-3">
                <div class="relative">
                    <div
                        class="bg-gray-200 rounded-full size-10 ring-2 ring-white shadow-md flex items-center justify-center text-text-muted">
                        <span class="material-symbols-outlined">person</span>
                    </div>
                    <div
                        class="absolute -bottom-0.5 -right-0.5 size-3 bg-accent-teal rounded-full border-2 border-white animate-pulse">
                    </div>
                </div>
                <div class="flex flex-col">
                    <span class="text-[10px] uppercase tracking-widest text-primary font-bold">PinkBlue MD</span>
                    <span class="text-sm font-bold text-text-main tracking-wide" id="user-display-name">DR. SMITH</span>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div
                    class="flex items-center gap-2 px-3 py-1 rounded-full bg-slate-50 border border-slate-200 shadow-inner-bright">
                    <span class="material-symbols-outlined text-accent-teal text-[16px]">wifi</span>
                    <span class="text-xs font-mono text-text-main font-medium">CONNECTED</span>
                </div>
            </div>
        </header>

        <main class="flex-1 flex flex-col relative z-10 px-6 pt-6 pb-28 overflow-y-auto hide-scroll">
            <div class="mb-8 text-center relative">
                <div class="inline-flex flex-col items-center">
                    <h2
                        class="text-primary text-xs font-bold tracking-[0.15em] mb-2 uppercase bg-blue-50 px-3 py-1 rounded-full">
                        Case Management</h2>
                    <h1 class="text-3xl font-bold text-text-main tracking-tight">Daily Rounds</h1>
                    <p class="text-text-muted text-sm mt-1">Ready to review assigned cases.</p>
                </div>
            </div>

            <div class="flex-1 flex flex-col items-center justify-center min-h-[280px]">
                <div class="relative group cursor-pointer" onclick="app.startRandomGame()">
                    <div class="absolute inset-0 rounded-full border border-primary/10 scale-150"></div>
                    <div
                        class="absolute inset-0 rounded-full border border-dashed border-primary/20 scale-125 animate-[spin_20s_linear_infinite]">
                    </div>
                    <button
                        class="relative flex flex-col items-center justify-center size-48 rounded-full bg-gradient-to-b from-white to-slate-50 border border-slate-200 shadow-[0_10px_40px_-10px_rgba(0,122,255,0.3)] active:scale-95 transition-all duration-300 pulse-ring group-hover:border-primary/30">
                        <div
                            class="absolute inset-3 rounded-full bg-white shadow-inner flex items-center justify-center border border-slate-100">
                            <div class="flex flex-col items-center gap-2 z-10">
                                <div
                                    class="p-4 bg-blue-50 rounded-full text-primary group-hover:bg-primary group-hover:text-white transition-colors duration-300">
                                    <span class="material-symbols-outlined text-[40px]">clinical_notes</span>
                                </div>
                                <div class="flex flex-col items-center">
                                    <span class="text-text-main font-bold text-sm tracking-wider">START</span>
                                    <span
                                        class="text-text-muted text-[10px] tracking-wider uppercase font-medium">Diagnosis</span>
                                </div>
                            </div>
                        </div>
                    </button>
                </div>

                <div
                    class="mt-10 text-center space-y-2 bg-white/60 backdrop-blur-sm p-4 rounded-xl border border-white/50 shadow-sm">
                    <p class="text-text-main text-sm font-semibold">New Cases Available</p>
                    <div class="flex items-center justify-center gap-2">
                        <span class="relative flex h-2 w-2">
                            <span
                                class="animate-ping absolute inline-flex h-full w-full rounded-full bg-accent-teal opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-2 w-2 bg-accent-teal"></span>
                        </span>
                        <span class="text-[10px] text-text-muted font-mono uppercase tracking-wide">Syncing...</span>
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-2 gap-4 mt-8">
                <div
                    class="col-span-2 bg-white rounded-2xl p-4 border border-border-light shadow-soft-panel text-center">
                    <p class="text-text-muted text-[10px] uppercase tracking-wider font-bold mb-2">Cases Solved</p>
                    <p class="text-text-main text-3xl font-bold font-display" id="dash-solved">0</p>
                </div>

                <button onclick="app.showHistory()"
                    class="col-span-2 py-3 rounded-xl bg-indigo-50 border-2 border-indigo-100 text-indigo-600 font-bold text-sm hover:bg-indigo-100 transition-colors flex items-center justify-center gap-2">
                    <span class="material-symbols-outlined">history</span>
                    View Case History
                </button>
            </div>
        </main>

        <!-- Leaderboard Widget -->
        <div class="mt-6 bg-white rounded-2xl p-5 border border-border-light shadow-soft-panel">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-sm font-bold text-text-main uppercase tracking-wider">Top Detectives</h3>
                <button onclick="app.openLeaderboard()"
                    class="text-xs font-bold text-primary hover:text-primary-dark">VIEW ALL</button>
            </div>
            <div class="space-y-3" id="dashboard-leaderboard">
                <!-- Loading State -->
                <div class="animate-pulse flex gap-3 items-center">
                    <div class="size-8 bg-slate-100 rounded-full"></div>
                    <div class="h-4 bg-slate-100 rounded w-24"></div>
                </div>
                <div class="animate-pulse flex gap-3 items-center">
                    <div class="size-8 bg-slate-100 rounded-full"></div>
                    <div class="h-4 bg-slate-100 rounded w-24"></div>
                </div>
                <div class="animate-pulse flex gap-3 items-center">
                    <div class="size-8 bg-slate-100 rounded-full"></div>
                    <div class="h-4 bg-slate-100 rounded w-24"></div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="mt-8 mb-12 grid grid-cols-2 gap-4 pb-12">
            <button onclick="window.location.href='https://pinkblue.in'"
                class="col-span-1 py-3 rounded-xl bg-white border-2 border-slate-200 text-text-sec font-bold text-sm hover:border-primary hover:text-primary transition-colors">
                Back to Store
            </button>
            <button onclick="app.shareLink()"
                class="col-span-1 py-3 rounded-xl bg-primary/10 border-2 border-primary/20 text-primary font-bold text-sm hover:bg-primary/20 transition-colors flex items-center justify-center gap-2">
                <span class="material-symbols-outlined text-lg">share</span>
                Share Link
            </button>
        </div>
        </main>
    </section>

    <!-- ===== GAME SCREEN (Stepped Flow) ===== -->
    <section id="game-screen" class="screen hidden flex flex-col h-full bg-background">
        <!-- Persistent Header -->
        <header class="flex-none z-30 px-6 pt-6 pb-2 bg-background-light">
            <div class="flex items-center justify-between mb-4">
                <button onclick="app.loadDashboard()"
                    class="flex items-center justify-center size-10 rounded-full bg-white border border-slate-200 text-text-sec shadow-sm">
                    <span class="material-symbols-outlined">close</span>
                </button>
                <div class="flex flex-col items-center">
                    <span class="text-[10px] font-bold tracking-widest uppercase text-text-muted mb-1"
                        id="step-indicator">STEP 1/3</span>
                    <h1 class="text-xl font-bold font-display text-text-main" id="pt-name">PATIENT</h1>
                </div>
                <div
                    class="flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-red-50 border border-red-100 shadow-sm">
                    <span class="material-symbols-outlined text-danger text-lg animate-pulse">timer</span>
                    <span class="text-danger font-mono font-bold" id="game-timer">00:00</span>
                </div>
            </div>

            <!-- Step Progress Bar -->
            <div class="flex gap-2 mb-2">
                <div id="prog-1" class="h-1 flex-1 rounded-full bg-primary transition-all"></div>
                <div id="prog-2" class="h-1 flex-1 rounded-full bg-slate-200 transition-all"></div>
                <div id="prog-3" class="h-1 flex-1 rounded-full bg-slate-200 transition-all"></div>
            </div>
        </header>

        <main class="flex-1 relative overflow-y-auto hide-scroll px-6 py-4">

            <!-- STEP 1: INTAKE (Vitals) -->
            <div id="step-1" class="game-step flex flex-col gap-4 animate-fade-in">
                <div class="text-center mb-4">
                    <h2 class="text-2xl font-bold text-text-main">Vitals & History</h2>
                    <p class="text-sm text-text-muted">Review patient status before proceeding.</p>
                </div>

                <!-- Interactive BP Card -->
                <div onclick="app.openVitalsModal('bp')"
                    class="group cursor-pointer bg-white p-5 rounded-2xl border border-slate-200 shadow-card hover:border-primary hover:shadow-lg transition-all active:scale-95">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-2">
                            <span class="material-symbols-outlined text-rose-500">cardiology</span>
                            <span class="text-xs font-bold text-text-sec uppercase tracking-wider">Blood Pressure</span>
                        </div>
                        <span
                            class="material-symbols-outlined text-primary opacity-0 group-hover:opacity-100 transition-opacity">open_in_full</span>
                    </div>
                    <div class="flex items-baseline gap-1">
                        <span class="text-4xl font-bold text-text-main font-display" id="pt-bp-sys-lg">--</span>
                        <span class="text-xl text-text-muted font-medium" id="pt-bp-dia-lg">/--</span>
                        <span class="text-xs text-text-sec ml-1">mmHg</span>
                    </div>
                    <div class="mt-3 w-full bg-slate-100 rounded-full h-1.5 overflow-hidden">
                        <div class="bg-rose-500 h-full w-[0%]" id="bp-bar-mini" style="transition: width 1s ease;">
                        </div>
                    </div>
                    <p class="text-[10px] text-text-muted mt-2 text-right">Tap for graph analysis</p>
                </div>

                <!-- Pain Level -->
                <div class="bg-white p-5 rounded-2xl border border-slate-200 shadow-card">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-2">
                            <span class="material-symbols-outlined text-amber-500">sentiment_very_dissatisfied</span>
                            <span class="text-xs font-bold text-text-sec uppercase tracking-wider">Pain Level</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="text-4xl font-bold text-text-main font-display" id="pt-pain-lg">0</span>
                        <div class="flex-1 flex flex-col gap-1">
                            <div class="w-full bg-slate-100 rounded-full h-2">
                                <div id="pt-pain-bar" class="bg-amber-500 h-full rounded-full transition-all w-0"></div>
                            </div>
                            <span class="text-xs font-bold text-amber-600 uppercase" id="pt-pain-text">Moderate</span>
                        </div>
                    </div>
                </div>

                <!-- Chief Complaint -->
                <div class="bg-blue-50/50 p-5 rounded-2xl border border-blue-100 shadow-inner">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="material-symbols-outlined text-primary">clinical_notes</span>
                        <span class="text-xs font-bold text-primary uppercase tracking-wider">Chief Complaint</span>
                    </div>
                    <p class="text-lg font-medium text-text-main leading-relaxed" id="history-complaint-lg">...</p>
                </div>
            </div>

            <!-- STEP 2: EXAM (Image) -->
            <div id="step-2" class="game-step hidden flex-col h-full animate-fade-in">
                <div class="text-center mb-4">
                    <h2 class="text-2xl font-bold text-text-main">Clinical Exam</h2>
                    <p class="text-sm text-text-muted">Identify anomalies in the region.</p>
                </div>

                <div
                    class="flex-1 relative bg-black rounded-xl overflow-hidden shadow-lg border-2 border-slate-200 group">
                    <img id="game-image-lg"
                        class="w-full h-full object-contain opacity-0 transition-opacity duration-500"
                        onload="this.classList.remove('opacity-0')">

                    <!-- No Image Placeholder -->
                    <div id="no-image-placeholder"
                        class="hidden absolute inset-0 flex flex-col items-center justify-center bg-slate-50 text-center p-8">
                        <span class="material-symbols-outlined text-5xl text-slate-300 mb-4">visibility_off</span>
                        <h3 class="text-lg font-bold text-text-main">No Radiographic Findings</h3>
                        <p class="text-sm text-text-muted">Diagnosis is based on clinical history alone.</p>
                    </div>

                    <!-- Hotspot -->
                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
                        <div class="relative flex items-center justify-center size-16">
                            <div class="absolute w-full h-full rounded-full bg-accent/30 animate-ping"></div>
                            <div
                                class="absolute w-10 h-10 rounded-full border-2 border-white bg-accent shadow-[0_0_20px_rgba(14,165,233,0.5)] flex items-center justify-center">
                                <span class="text-white font-bold font-display text-sm">A</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-4 p-4 bg-white rounded-xl border border-slate-200 shadow-sm">
                    <h4 class="text-xs font-bold text-text-muted uppercase mb-1">Clinical Findings</h4>
                    <p class="text-sm text-text-main" id="exam-findings-lg">...</p>
                </div>
            </div>

            <!-- STEP 3: DIAGNOSIS (Options) -->
            <div id="step-3" class="game-step hidden flex-col h-full animate-fade-in">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-text-main">Final Diagnosis</h2>
                    <p class="text-sm text-text-muted">Select the most probable condition.</p>
                </div>

                <div class="grid grid-cols-1 gap-3 flex-1 overflow-y-auto pb-4" id="game-options-lg">
                    <!-- Options injected via JS -->
                </div>
            </div>

        </main>

        <!-- Footer Navigation -->
        <footer class="flex-none p-6 pb-24 pt-2 bg-white z-30 flex gap-3">
            <button id="prev-btn" onclick="app.prevStep()"
                class="hidden w-1/3 py-4 rounded-xl bg-slate-100 text-text-muted font-bold text-lg hover:bg-slate-200 transition-all flex items-center justify-center gap-2">
                <span class="material-symbols-outlined">arrow_back</span>
                <span>BACK</span>
            </button>
            <button id="next-btn" onclick="app.nextStep()"
                class="flex-1 py-4 rounded-xl bg-primary text-white font-bold text-lg shadow-lg hover:shadow-xl hover:bg-primary-dark transition-all transform active:scale-95 flex items-center justify-center gap-2">
                <span>NEXT STEP</span>
                <span class="material-symbols-outlined">arrow_forward</span>
            </button>
            <button id="submit-btn-lg" onclick="app.submitAnswer()"
                class="hidden w-full py-4 rounded-xl bg-emerald-500 text-white font-bold text-lg shadow-lg hover:shadow-xl hover:bg-emerald-600 transition-all transform active:scale-95 flex items-center justify-center gap-2">
                <span>CONFIRM DIAGNOSIS</span>
                <span class="material-symbols-outlined">check_circle</span>
            </button>
        </footer>
    </section>

    <!-- ===== VITALS DETAIL MODAL ===== -->
    <section id="vitals-modal"
        class="fixed inset-0 z-[60] flex items-end sm:items-center justify-center bg-black/60 backdrop-blur-sm hidden animate-fade-in">
        <div
            class="w-full max-w-sm bg-white rounded-t-3xl sm:rounded-3xl p-6 relative animate-slide-up sm:animate-zoom-in">
            <button onclick="document.getElementById('vitals-modal').classList.add('hidden')"
                class="absolute top-4 right-4 p-2 bg-slate-100 rounded-full hover:bg-slate-200 transition-colors">
                <span class="material-symbols-outlined">close</span>
            </button>

            <div id="modal-content-bp" class="hidden text-center">
                <div class="inline-flex p-3 bg-rose-50 rounded-full text-rose-500 mb-4 ring-4 ring-rose-50/50">
                    <span class="material-symbols-outlined text-3xl">cardiology</span>
                </div>
                <h2 class="text-xl font-bold text-text-main mb-1">Blood Pressure Analysis</h2>
                <p class="text-sm text-text-muted mb-6">Real-time reading (Systolic/Diastolic)</p>

                <!-- Graph Visualization -->
                <div
                    class="relative h-48 w-full bg-slate-50 rounded-xl border border-slate-100 mb-6 flex items-end justify-center gap-8 px-8 pb-4">
                    <!-- Target Lines -->
                    <div class="absolute w-full border-t border-dashed border-slate-300 top-1/3 left-0"><span
                            class="absolute -top-3 right-2 text-[10px] text-slate-400">High (140)</span></div>
                    <div class="absolute w-full border-t border-dashed border-emerald-300 top-2/3 left-0"><span
                            class="absolute -top-3 right-2 text-[10px] text-emerald-500">Normal (120)</span></div>

                    <!-- Bars -->
                    <div class="w-12 bg-rose-500 rounded-t-lg relative group transition-all duration-1000"
                        id="sys-bar-graph" style="height: 0%">
                        <span class="absolute -top-6 left-1/2 -translate-x-1/2 font-bold text-rose-600"
                            id="sys-val-graph">120</span>
                        <div class="absolute bottom-2 left-1/2 -translate-x-1/2 text-[10px] text-white/90">SYS</div>
                    </div>
                    <div class="w-12 bg-rose-300 rounded-t-lg relative group transition-all duration-1000"
                        id="dia-bar-graph" style="height: 0%">
                        <span class="absolute -top-6 left-1/2 -translate-x-1/2 font-bold text-rose-400"
                            id="dia-val-graph">80</span>
                        <div class="absolute bottom-2 left-1/2 -translate-x-1/2 text-[10px] text-white/90">DIA</div>
                    </div>
                </div>

                <div class="p-3 bg-slate-50 rounded-xl text-xs text-left text-text-sec">
                    Using American Heart Association guidelines. Reading indicates <strong
                        id="bp-category">Normal</strong> levels.
                </div>
            </div>
        </div>
    </section>

    <!-- ===== RESULT MODAL (Bright) ===== -->
    <section id="result-modal"
        class="fixed inset-0 z-50 flex items-center justify-center px-4 bg-black/50 backdrop-blur-sm hidden">
        <div class="w-full max-w-md bg-white border border-white/20 rounded-2xl p-6 relative shadow-2xl">
            <div class="text-center mb-6">
                <div class="size-20 bg-green-50 rounded-full flex items-center justify-center mx-auto mb-4 border-2 border-green-100"
                    id="result-icon-container">
                    <span class="material-symbols-outlined text-4xl text-green-500" id="result-icon">check</span>
                </div>
                <h2 class="text-2xl font-bold text-text-main mb-1" id="result-title">Correct!</h2>
                <p class="text-sm text-text-muted" id="result-score">+100 Points</p>
            </div>

            <div
                class="bg-slate-50 rounded-lg p-4 mb-6 text-sm text-text-sec border border-slate-200 max-h-40 overflow-y-auto">
                <p id="result-explanation">Explanation...</p>
            </div>

            <div id="reward-box"
                class="hidden mb-6 p-4 bg-gradient-to-r from-pink-50 to-rose-50 border border-primary/20 rounded-xl relative overflow-hidden">
                <div class="absolute -right-4 -top-4 text-primary/10 text-9xl transform rotate-12 select-none">üéÅ</div>
                <div class="relative z-10 flex items-center gap-3 mb-3">
                    <span class="text-3xl bg-white p-2 rounded-lg shadow-sm">üéüÔ∏è</span>
                    <div>
                        <p class="text-xs font-bold text-primary uppercase tracking-wider">Reward Unlocked</p>
                        <p class="text-lg font-bold text-text-main leading-tight" id="reward-desc">5% OFF Code</p>
                    </div>
                </div>

                <div class="relative z-10 bg-white border border-dashed border-primary/30 rounded-lg p-1.5 flex gap-2">
                    <code
                        class="flex-1 flex items-center justify-center font-mono text-xl text-primary font-black tracking-widest"
                        id="reward-code">CODE123</code>
                    <button
                        onclick="navigator.clipboard.writeText(document.getElementById('reward-code').textContent).then(() => window.ui.showToast('Code copied!', 'success'))"
                        class="p-2 bg-primary/10 rounded hover:bg-primary/20 text-primary transition-colors"
                        title="Copy Code">
                        <span class="material-symbols-outlined text-xl">content_copy</span>
                    </button>
                </div>

                <div class="relative z-10 mt-3 pt-3 border-t border-primary/10">
                    <a href="https://pinkblue.in/cart" target="_blank"
                        class="w-full py-2.5 rounded-lg bg-primary text-white font-bold text-sm shadow flex items-center justify-center gap-2 hover:bg-primary-dark transition-colors">
                        Redeem Now <span class="material-symbols-outlined text-lg">open_in_new</span>
                    </a>
                </div>
            </div>

            <button class="w-full py-3 rounded-lg bg-primary text-white font-bold shadow-lg"
                onclick="app.closeResult()">
                CONTINUE
            </button>
        </div>
    </section>

    <!-- ===== INSTRUCTIONS MODAL (Medical Briefing) ===== -->
    <section id="instructions-modal"
        class="fixed inset-0 z-50 flex items-center justify-center px-4 bg-black/50 backdrop-blur-sm hidden">
        <div class="w-full max-w-md bg-white border border-white/20 rounded-2xl p-6 relative shadow-2xl">
            <div class="text-center mb-6">
                <div
                    class="size-16 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4 border-2 border-blue-100">
                    <span class="material-symbols-outlined text-3xl text-primary">info</span>
                </div>
                <h2 class="text-2xl font-bold text-text-main mb-1">Medical Briefing</h2>
                <p class="text-sm text-text-muted">Review the case details carefully.</p>
            </div>

            <div class="space-y-4 mb-8">
                <div class="flex items-start gap-3 p-3 bg-slate-50 rounded-xl border border-slate-100">
                    <span class="material-symbols-outlined text-primary mt-0.5">radiology</span>
                    <div class="text-sm">
                        <span class="font-bold text-text-main block">Analyze Findings</span>
                        <span class="text-text-sec">Review patient vitals, history, and radiographs.</span>
                    </div>
                </div>
                <div class="flex items-start gap-3 p-3 bg-slate-50 rounded-xl border border-slate-100">
                    <span class="material-symbols-outlined text-primary mt-0.5">clinical_notes</span>
                    <div class="text-sm">
                        <span class="font-bold text-text-main block">Diagnose</span>
                        <span class="text-text-sec">Select the most likely condition from the options.</span>
                    </div>
                </div>
                <div class="flex items-start gap-3 p-3 bg-slate-50 rounded-xl border border-slate-100">
                    <span class="material-symbols-outlined text-primary mt-0.5">timer</span>
                    <div class="text-sm">
                        <span class="font-bold text-text-main block">Time Sensitive</span>
                        <span class="text-text-sec">Complete your diagnosis before the timer runs out.</span>
                    </div>
                </div>
            </div>

            <button
                class="w-full py-3.5 rounded-xl bg-primary text-white font-bold shadow-lg hover:bg-primary-dark transition-all transform active:scale-95"
                onclick="app.closeInstructions()">
                BEGIN ROUNDS
            </button>
        </div>
    </section>

    <!-- ===== HISTORY MODAL ===== -->
    <section id="history-modal"
        class="fixed inset-0 z-50 flex items-center justify-center px-4 bg-black/50 backdrop-blur-sm hidden">
        <div class="w-full max-w-md bg-white rounded-2xl p-6 h-[70vh] flex flex-col shadow-2xl">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center gap-2">
                    <span class="material-symbols-outlined text-primary">history</span>
                    <h2 class="font-bold text-xl text-text-main">Case History</h2>
                </div>
                <button onclick="document.getElementById('history-modal').classList.add('hidden')"
                    class="p-2 bg-slate-100 rounded-full hover:bg-slate-200">
                    <span class="material-symbols-outlined text-sm">close</span>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto space-y-3" id="history-list">
                <!-- Populated by JS -->
                <div class="text-center py-8 text-text-muted text-sm">Loading history...</div>
            </div>
        </div>
    </section>

    <!-- ===== LEADERBOARD MODAL ===== -->
    <section id="leaderboard-modal"
        class="fixed inset-0 z-50 flex items-center justify-center px-4 bg-black/50 backdrop-blur-sm hidden">
        <div class="w-full max-w-md bg-white rounded-2xl p-6 h-[70vh] flex flex-col shadow-2xl">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center gap-2">
                    <span class="material-symbols-outlined text-amber-500">trophy</span>
                    <h2 class="font-bold text-xl text-text-main">Leaderboard</h2>
                </div>
                <button onclick="document.getElementById('leaderboard-modal').classList.add('hidden')"
                    class="p-2 bg-slate-100 rounded-full hover:bg-slate-200">
                    <span class="material-symbols-outlined text-sm">close</span>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto space-y-2" id="leaderboard-list-full">
                <!-- Dynamically populated -->
                <div class="text-center py-8 text-text-muted text-sm">Loading...</div>
            </div>
        </div>
    </section>

    <!-- External Dependencies (Load FIRST) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Configuration (Load SECOND) -->
    <script src="config.js"></script>

    <!-- Modules (Load THIRD - Remove type="module") -->
    <script src="modules/database.js"></script>
    <script src="modules/ui.js"></script>
    <script src="modules/auth.js"></script>
    <script src="modules/cases.js"></script>
    <script src="modules/game.js"></script>

    <!-- Main App (Load LAST) -->
    <script src="app.js"></script>

</body>

</html>